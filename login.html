<!DOCTYPE html>
<html>
<head>
    <title>Student Login - CvSU Online School Store</title>
    <meta charset="UTF-8">
    <link rel="stylesheet" type="text/css" href="css/style.css">
    <script src="https://accounts.google.com/gsi/client" async defer></script>
</head>
<body>
    <div class="container login-container">
        <div class="login-card">
            <div class="login-header">
                <img src="photos/kabsu.png" alt="CvSU Logo" class="login-logo">
                <h1>CvSU Student Login</h1>
                <p>Sign in with your CvSU Google account to access the store</p>
            </div>
            
            <div class="login-content">
                <div id="g_id_onload"
                     data-client_id="357721408840-cm10rj5qo1eme5hsa22gfrgm2pcfip0a.apps.googleusercontent.com"
                     data-callback="handleCredentialResponse"
                     data-auto_prompt="false">
                </div>
                <div class="g_id_signin" 
                     data-type="standard"
                     data-size="large"
                     data-theme="outline"
                     data-text="sign_in_with"
                     data-shape="rectangular"
                     data-logo_alignment="left">
                </div>
                
                <div class="login-info">
                    <h3>Requirements:</h3>
                    <ul>
                        <li>Must use CvSU Google account (@cvsu.edu.ph)</li>
                        <li>Valid student enrollment status</li>
                        <li>Access restricted to current students only</li>
                    </ul>
                </div>
                
                <div class="login-error" id="loginError" style="display: none;">
                    <p>Access denied. Please use your official CvSU Google account (@cvsu.edu.ph)</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        function handleCredentialResponse(response) {
            const responsePayload = decodeJwtResponse(response.credential);
            
            // Check if email is from CvSU domain
            if (!responsePayload.email.endsWith('@cvsu.edu.ph')) {
                document.getElementById('loginError').style.display = 'block';
                return;
            }
            
            // Store student info in sessionStorage
            sessionStorage.setItem('currentStudent', JSON.stringify({
                email: responsePayload.email,
                name: responsePayload.name,
                picture: responsePayload.picture,
                verified: true
            }));
            
            // Redirect to store
            window.location.href = 'index.html';
        }
        
        function decodeJwtResponse(token) {
            var base64Url = token.split('.')[1];
            var base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');
            var jsonPayload = decodeURIComponent(atob(base64).split('').map(function(c) {
                return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);
            }).join(''));
            return JSON.parse(jsonPayload);
        }
    </script>
</body>
</html>